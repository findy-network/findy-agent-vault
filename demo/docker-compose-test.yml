version: "3"
services:
  agency:
    build:
      context: .docker/findy-agent-cli/agency
      args:
        HTTPS_PREFIX: ${HTTPS_PREFIX}
    ports:
      - "8080:8080"
      - "50052:50051"
    volumes:
      - .docker/findy-common-go/cert:/cert
      - ./conf/steward.exported:/steward.exported
      - ./conf/genesis_transactions:/genesis_transactions
    environment:
      FCLI_AGENCY_SALT: "salt"
      FCLI_AGENCY_HOST_ADDRESS: "agency"
      FCLI_AGENCY_HOST_PORT: "8080"
      FCLI_AGENCY_GRPC_CERT_PATH: "/cert"
      FCLI_POOL_NAME: "FINDY_FILE_LEDGER"
      FCLI_AGENCY_POOL_NAME: "FINDY_FILE_LEDGER"

  vault-db:
    image: postgres:13.1-alpine
    environment:
      POSTGRES_PASSWORD: "my-secret-password"
      POSTGRES_DB: vault
    volumes:
      - ./.docker/db/data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  vault:
    build:
      context: ..
      args:
        HTTPS_PREFIX: ${HTTPS_PREFIX}
    ports:
      - "8085:8085"
    volumes:
      - .docker/findy-common-go/cert:/cert
    environment:
      FAV_JWT_KEY: "mySuperSecretKeyLol"
      FAV_DB_HOST: "vault-db"
      FAV_DB_PASSWORD: "my-secret-password"
      FAV_AGENCY_HOST: "agency"
      FAV_AGENCY_PORT: "50051"
      FAV_AGENCY_CERT_PATH: "/cert"
    depends_on:
      - agency
      - vault-db
#  auth:
#    build:
#      context: .docker/findy-agent-auth
#      args:
#        HTTPS_PREFIX: ${HTTPS_PREFIX}
#    ports:
#      - "8888:8888"
#    volumes:
#      - .docker/findy-common-go/cert:/cert
#    environment:
#      FAA_PORT: "8888"
#      FAA_AGENCY_ADDR: "agency"
#      FAA_AGENCY_PORT: "50051"
#      FAA_DOMAIN: "localhost"
#      FAA_ORIGIN: "http://localhost:8888"
#      FAA_JWT_VERIFICATION_KEY: "mySuperSecretKeyLol"
#    depends_on:
#      - agency

